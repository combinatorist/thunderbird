From: Carsten Schoenert <c.schoenert@t-online.de>
Date: Sun, 30 Sep 2018 17:41:11 +0200
Subject: Bug 1479540 - Accept "triplet" strings with only two parts in
 moz.configure. r=froydnj, a=jcristau

Origin: https://hg.mozilla.org/releases/mozilla-release/rev/bc651d3d910c
Bug-Debian: None
Bug: https://bugzilla.mozilla.org/show_bug.cgi?id=149540
Applied-Upstream: firefox60.2.2
---
 build/moz.configure/init.configure | 11 ++++++++++-
 1 file changed, 10 insertions(+), 1 deletion(-)

diff --git a/build/moz.configure/init.configure b/build/moz.configure/init.configure
index cbe3a3f..0d0f048 100644
--- a/build/moz.configure/init.configure
+++ b/build/moz.configure/init.configure
@@ -577,7 +577,16 @@ def split_triplet(triplet, allow_unknown=False):
     # There is also a quartet form:
     #   CPU_TYPE-MANUFACTURER-KERNEL-OPERATING_SYSTEM
     # But we can consider the "KERNEL-OPERATING_SYSTEM" as one.
-    cpu, manufacturer, os = triplet.split('-', 2)
+    # Additionally, some may omit "unknown" when the manufacturer
+    # is not specified and emit
+    #   CPU_TYPE-OPERATING_SYSTEM
+    parts = triplet.split('-', 2)
+    if len(parts) == 3:
+        cpu, _, os = parts
+    elif len(parts) == 2:
+        cpu, os = parts
+    else:
+        die("Unexpected triplet string: %s" % triplet)
 
     # Autoconf uses config.sub to validate and canonicalize those triplets,
     # but the granularity of its results has never been satisfying to our
